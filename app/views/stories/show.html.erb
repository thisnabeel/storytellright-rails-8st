<style>

	.acts {
		margin: 10px 0;
	}
	.act {
		padding: 10px;
	}

	.act h1 {
		text-align: center;
		font-family: 'VT323', monospace;
		color: #e74c3c;
	}

	.message-form .fr-view p {
		font-family: 'VT323', monospace !important;
		font-size: 24px;
	}

	.acts i {
		font-size: 20px;
		cursor: pointer;
	}

	.acts .fleshed-out-act {
		color: #27ae60;
	}

	.fleshed-out {
		display: none;
	}

	.froalize .fr-view {
		/*background-color: #fff;*/
		color: #9e7806;
	}

	.story-wrapper {
		padding: 100px;
	}
	.story-title {
		padding: 30px;
	}

	.necessary-form li {
		list-style: none;
    	background: #fff;
    	padding: 10px;
    	margin: 10px;
	}

	.necessary-form>ul>li {
		position: relative;
	}

	.characters li {
		border: 6px solid #E8E8E8;
	}

	.characters .character-name input {
		background-color: #ffffff;
    	color: #007bff;
    	font-weight: bold;
	}

	.connection {
		padding: 14px 0;
	}

	.characters {
		display: none;
	}
	


	#notes-opener, .notes-opener {
		display: none;
	    position: fixed;
	    right: 0;
	    top: 0;
	    height: 100%;
	    background: #a5fffb !important;
	    padding: 10px;
	    min-width: 10px;
	    
	    -webkit-box-shadow: 10px 10px 70px -16px rgba(0,0,0,0.56);
		-moz-box-shadow: 10px 10px 70px -16px rgba(0,0,0,0.56);
		box-shadow: 10px 10px 70px -16px rgba(0,0,0,0.56);
	}

	#notes a {
		color: #92eaff;
	}

	#notes {
		display: none;
	    position: fixed;
	    z-index: 9999;
	    right: 0;
	    top: 0;
	    height: 100%;
	    padding: 30px;
	    background: #2e2222;
    	color: #fff;
	    min-width: 225px;
   		max-width: 225px;
		-webkit-box-shadow: -10px 10px 17px -16px rgba(0,0,0,0.38);
		-moz-box-shadow: -10px 10px 17px -16px rgba(0,0,0,0.38);
		box-shadow: -10px 10px 17px -16px rgba(0,0,0,0.38);
	}



	.boolean-toggle {
		position: relative;
    	text-align: right;
	}
	
	.color-nav {
		/*display: inline;*/
	}
	.color-select {
		display: inline-block;
	    height: 10px;
	    width: 50px;
	    margin: 0px;
	    border-radius: 3px;
	}
	
	.color-select.villian {
		border: 1px solid #ff4757;
	}
	.color-select.villian.active,
	#characters-list .villian {
		background: #ff4757;
		color: #fff;
	}

	.color-select.clone,  {
		border: 1px solid #2ed573;
	}
	.color-select.clone.active {
		background: #2ed573;
	}

	.color-select.support {
		border: 1px solid #70a1ff;
	}
	.color-select.support.active {
		background: #70a1ff;
	}

	.color-select.alternative,
	#characters-list .alternative
	 {
		border: 1px solid #f9ca24;
	}

	.color-select.alternative.active,
	#characters-list .alternative {
		background: #f9ca24;
	}
	
	.color-blue .fr-view {
		color: #0669c1 !important;
	}


/*	.characters-count-badge {
		height: 10px;
		width: 10px;
		position: absolute;
		top: 0px;
		right: -10px;
		color: #9b59b6;
	}*/

	.mini-input {
		max-width: 200px;
		display: inline-block;
		position: relative;
		right: 0;
	}

	.extra-details {
		display: none;
	}

	.inputs {
		position: relative;
		max-width: 210px;
		margin: 0 auto;
	}

	.toggle-extra {
		position: absolute;
		right: -20px;
		top: 20px;
		font-size: 22px;
	}

	article.part {
		padding: 20px;
	}

	#part-0 {
		/* border: 20px solid #7bed9f; */
	}

	#part-1 {
		/* border: 20px solid #7bed9f; */
	}

	#part-2 {
		border: 20px solid #ff6b81;
	}

	#part-3 {
		border: 20px solid #a29bfe;
		background-color: #fff;
	}

	#part-4 {
		border: 20px solid #fff;
		background-color: #fff;
	}

	.armature, .punchline {
		max-width: 55px;
	}

	.promise {
		max-width: 25px;
	}

	.bomb {
		max-width: 75px;
	}

	.armature-descendants {
		list-style: none;
	}

	.armature-descendants li {
	    display: inline-block;
	    width: 20px;
	    height: 20px;
	    background-color: transparent;
	    border: 2px solid #e84393;
	    border-radius: 100%;
	}

	.selected {
	    margin-top: 20px;
	    line-height: 50px;
	}

	.selected li {
		list-style: none;
	    display: inline-block;
	    padding: 14px;
	    background: #fff;
	    border-radius: 15px;
	    margin: 4px;
	    position: relative;
	}

	.selected .remove-item {
		position: absolute;
		top: 0px;
		left: 0px;
		color: #ccc;
	}

	.selected .remove-item:hover {
		color: #000;
	}

	.modal-dialog .modal-title {
		font-size: 34px;
		color: #5f27cd;
	}

	.modal-dialog ul {
		margin: 20px;
	}

	.modal-dialog {
	    max-width: 690px;
	    margin: 1.75rem auto;
	}

	.modal-content {
		padding: 3rem;
	}

	#part-3 .act-1.scenes-list li:not(:last-child),
	#part-3 .act-1.skeleton-list li:not(:last-child) {
		background-color: #00a8ff;
		color: #fff;
	}

	#part-3 .act-1.scenes-list li:last-child,
	#part-3 .act-1.skeleton-list li:last-child {
		/*border: 3px dashed #ed143d;*/
		background-color: #B53471;
		color: #fff;
	}

	#part-3 .act-3.scenes-list li:first-child,
	#part-3 .act-3.skeleton-list li:first-child {
	    background-color: #ed143d ;
	    color: #fff;
	}
	
	#part-3 .act-3.scenes-list li:nth-child(2),
	#part-3 .act-3.skeleton-list li:nth-child(2) {
	    background-color: #fff24f;
	    color: #000000;
	    margin-top: -10px;
    	position: relative;
    	top: -10px;
    	left: 10px;
    	border: 4px dashed #ff67af;
	}

	#part-3 .act-3.scenes-list li:last-child,
	#part-3 .act-3.skeleton-list li:last-child {
		background-color: #068733;
		color: #fff;
	}

	.scenes-list, 
	.skeleton-list {
		list-style: none;
	}

	.scenes-list li,
	.skeleton-list li {
		padding: 20px;
		-webkit-box-shadow: 0px 5px 14px -6px rgba(0,0,0,0.50);
		-moz-box-shadow: 0px 5px 14px -6px rgba(0,0,0,0.50);
		box-shadow: 0px 5px 14px -6px rgba(0,0,0,0.50);
		position: relative;
		margin: 10px 0;
	}

	.the-end, .scene-pic {
		max-width: 90px;
    	margin: 0 auto;
    	display: block;
	}

	.scenes-list .remove-item {
		position: absolute;
		top: 0;
		left: -5px;
	}

	.remove-item {
		color: #f1f1f1;
	}

	.remove-item:hover {
		color: #000;
	}

	@media (min-width: 576px) {
		.modal-dialog {
		    max-width: 690px;
		    margin: 1.75rem auto;
		}
	}

	.final-showdown {
		position: absolute;
    	top: 40px;
    	z-index: 9;
    	right: -20px;
	}

	.seatbelt {
	    max-width: 125px;
	    bottom: -25px;
	    border-radius: 10px;
	    z-index: 999;
	    /*background: #bfa000;*/
	    /*filter: invert(100%);*/
	    /* right: 2.5em; */
	    /* margin: 0 auto; */
	    /* text-align: center; */
		position: absolute;
		margin-left: auto;
		margin-right: auto;
		left: 0;
		right: 0;
		/*padding: 10px;*/
	}

	.promise-click {
	    max-width: 45px;
	    position: absolute;
	    right: -25px;
	    bottom: 10px;
	}

	.go-to-simple {
		position: fixed;
		top: 10px;
		right: 20px;
		z-index: 999;
	}

	/**/

	.deet li:hover {
		color: #5f27cd;
		background-color: #f5f4f4;
	}


	.fr-placeholder {
		margin-top: 0 !important;
	}

	/**/
	.cover-image img {
		max-width: 200px;
    	max-height: 260px;
	}

	/**/
	.becoz-box {
	    padding: 10px;
	    background: #000;
	    color: #fff;
	    border-radius: 5px;

	    display: none;
	}

	.piece {
		display: block;
	}

	.piece-box i {
		background: blueviolet;
    	display: block;
    	padding: 0 10px;

	}

	#characters-list > section {
    	overflow-y: scroll;
    	max-height: 84vh;
    	width: 118%;
	}
	
	/**/

	.top-bar {
		position: fixed;
	    left: 25%;
	    right: 50%;
	    width: 50vw;
	    margin: 0 auto;
	    z-index: 999999;
	    border-radius: 0px 0px 15px 15px;
	    border-bottom: 1px solid #ccc;
	    background: #F3F1F0;
	}

	.top-bar ul {
		list-style: none;
		padding: 0;
		text-align: center;
    	padding-top: 18px;
    	background: transparent !important;
	}

	.top-bar li {
		display: inline;
		padding: 10px;
		margin: 10px;
		color: #575757
	}

	.top-bar ul {
		background: #fff;
	}

	.top-bar .active-view {
		border-bottom: 2px dashed #000;
	}

	.II-because {
		color: #fff;
		background: #000;
	}
		
	.II-because h3 {
		background: #8a2be2;
    	padding: 10px;
	}

	.II-because p {
		padding: 20px;
	}

	/**/
	.trailer-main {
    	/*color: #fff;*/
    	/*border: 6px solid #000;*/
    	border: 8px dashed #ff0100 !important;
    	text-align: center;
    	padding: 30px;
	}

	.make-red {
		background: red;
    	color: #fff;
    	padding: 30px;
	}

	.make-red .fr-view {
		color: #fff;
	}

	.border-red {
		border: 8px solid #ff0100 !important;
	}

	.border-end {
		border: 8px solid #000 !important;
		background: #000;
		color: #fff;
	}

	.border-end .fr-view {
		color: #fff ;
	}

	/**/
	.center-all {
		padding: 30px;
    	text-align: center;
    	position: relative;
	}

	.add-pp {
		position: absolute;
		bottom: 5px;
		right: 5px;
	}

	/**/

	.more-hint {
		font-family: fantasy;
	}

	.curtain {
		padding: 30px;
		text-align: center;
	}

	/**/
	.message {
		border-radius: 5px;
	    font-size: 22px;
	    background: blue;
	    color: #fff;
	    text-align: center;
	    padding: 40px;
	}

	.message-because {
		border: 2px solid #0000ff;
		background: transparent;
		text-align: center;
    	padding: 30px;
	}

	.message-because > b {
		color: #0000ff;
	}

	.melo {
		padding: 20px;
		border-left: 2px solid #ccc;
		background: #000;
    	color: #7fff00;
	}

	.inspiration-click {
		z-index: 99999;
	}

	#film-watch {
		display: none;
	}

	.toggle-video {
		position: absolute;
    	left: -22px;
    	top: 20px;
    	font-size: 24px;
	}

	<% if user_signed_in? && @story.user != current_user %>
	<% end %>

</style>

<!-- <a class="btn btn-warning btn-lg go-to-simple" href="/stories/<%= @story.id %>/essay">Simple View</a> -->

<%= render "stories/top_bar"%>


<div class="story-wrapper">
	<div class="title-form">
		<h1 class="text-center story-title froalize">

			<textarea>
				<%= @story.title %>
			</textarea>
			
			<div class="cover-image">
				<img src="<%= @story.cover %>" alt="">
			</div>

			<div class="inputs">
				
				<input type="text" class="form-control year-input mini-input" value="<%= @story.year %>">
				<i class="fa fa-plus toggle-extra"></i>
				<i class="fa fa-play-circle toggle-video"></i>
				<div class="extra-details">
					<input type="text" class="form-control tags-input mini-input" value="<%= @story.tags %>" placeholder="Tags..."><br>
					<input type="text" class="form-control writer-input mini-input" value="<%= @story.writer %>" placeholder="Writer...">
					<input type="text" class="form-control link-input mini-input" value="<%= @story.link %>" placeholder="Link...">
					<input type="text" class="form-control series-input mini-input" value="<%= @story.series %>" placeholder="Series...">

					<input type="text" class="form-control cover-input mini-input" value="<%= @story.cover %>" placeholder="Cover Picture...">
				</div>
			</div>
		</h1>

		<video id="film-watch" src="<%= @story.link %>" width="100%" height="350px" controls>
		</video>
	</div>
	
	<section class="boolean-toggle <%= 'hidden' if !User.is_admin? current_user %>">
		<input type="checkbox" id="status" data-group-cls="btn-group-lg" data-off-title="Unready" data-on-title="Ready">
	</section>

	<div class="fa fa-file-image-o show-places">
	</div>
	<img src="<%= asset_path('puzzle.png') %>" class="show-puzzle" alt="">


	<br>



	<section class="scaffold">


		<!-- Part 0 -->

		<%= render "stories/sections/bonfire" %>

		<!--  -->

		<%= render "stories/sections/climax" %>

		<!--  -->
		
		<%= render "stories/sections/hell" %>

		<!--  -->

		<%= render "stories/sections/route" %>

		<!--  -->

		<%= render "stories/sections/plot" %>

		<!--  -->

		
			<article class="part hidden" id="part-2">
			<div class="hidden">
				<p>What kind of transition is this? </p>
					<% transition = @story.story_details["transition"].html_safe if @story.story_details.present? && @story.story_details["transition"].present? %>
					<% transtion_list = {
						"d-a" => "Denial -> Acceptance",
						"a-a" => "Acceptance -> Acceptance",
						"a-d" => "Acceptance -> Denial",
						"d-d" => "Denial -> Denial",
					} %>
					<select value="transition" class="transition">
						<% transtion_list.each do |t| %>
							<option value="<%= t[0] %>" <%= 'selected' if transition == t[0] %> ><%= t[1] %></option>
						<% end %>
					</select>
				<br>
				<hr>
			</div>

			<h1 class="curtain">The End</h1>

			
			<div class="center-all border-end">
				<p>What <img src="<%= asset_path('punchline.png') %>" alt="" class="punchline"> do you want to use for this message? <i class="fa fa-question-circle"></i> 
					<p class="more-hint">[Show impact of journey]</p>
				</p>
				<div class="message-form froalize save-this" data-save-code="woah-moment">
					<textarea>
						<%= @story.story_details["woah-moment"].html_safe if @story.story_details.present? && @story.story_details["woah-moment"].present?  %>
					</textarea>
				</div>
				

				<!--  -->
				<hr>
				<div class="necessary-form">
					<ul class="pp-list n-list">
						
					</ul>
				</div>

				<i class="fa fa-plus btn btn-primary add-pp"></i>
			</div>
			
			<!--  -->
			<h1 class="curtain">Act II Curtain</h1>
			<!--  -->
			
			<div class="center-all make-red">
				<p>What <img src="<%= asset_path('final_showdown.png') %>" alt="" class="punchline"> forces the <img src="<%= asset_path('punchline.png') %>" alt="" class="punchline"> <i class="fa fa-question-circle"></i> 
					<p class="more-hint">[Testing time]</p>
				</p>
				<div class="message-form froalize save-this" data-save-code="showdown-test">
					<textarea>
						<%= @story.story_details["showdown-test"].html_safe if @story.story_details.present? && @story.story_details["showdown-test"].present?  %>
					</textarea>
				</div>
				
				<!--  -->
				<hr>
				<div class="necessary-form">
					<ul class="pp-list n-list">
						
					</ul>
				</div>

				<i class="fa fa-plus btn btn-primary add-pp"></i>
			</div>

			<div class="trailer-main center-all back-blue">
				<p>What <img src="<%= asset_path('vision.png') %>" alt="" class="bomb"> decides the <img src="<%= asset_path('final_showdown.png') %>" alt="" class="punchline">? <i class="fa fa-question-circle"></i>
					<p class="more-hint">[Prepare for the Final Test]</p>
				</p>
				<small class="trailer-main-copy"></small>
				<hr>
				<div class="message-form froalize save-this" data-save-code="vision-for-heart">
					<textarea>
						<%= @story.story_details["vision-for-heart"].html_safe if @story.story_details.present? && @story.story_details["vision-for-heart"].present? %>
					</textarea>
				</div>
				
				<!--  -->
				<hr>
				<div class="necessary-form">
					<ul class="pp-list n-list">
						
					</ul>
				</div>

				<i class="fa fa-plus btn btn-primary add-pp"></i>
			</div>
			
			<h1 class="curtain">Act I Curtain</h1>

			<div class="make-red center-all">
				<p>What <img src="<%= asset_path('bomb.png') %>" alt="" class="bomb"> forces the <img src="<%= asset_path('vision.png') %>" alt="" class="punchline">? <i class="fa fa-question-circle"></i> 
					<p class="more-hint">[Start journey]</p>
				</p>
				<hr>
				<div class="message-form froalize save-this" data-save-code="bomb-for-vision">
					<textarea>
						<%= @story.story_details["bomb-for-vision"].html_safe if @story.story_details.present? && @story.story_details["bomb-for-vision"].present? %>
					</textarea>
				</div>
				
				<!--  -->
				<hr>
				<div class="necessary-form">
					<ul class="pp-list n-list">
						
					</ul>
				</div>

				<i class="fa fa-plus btn btn-primary add-pp"></i>
			</div>

			<div class="border-red center-all">
				<p>Why is the <img src="<%= asset_path('bomb.png') %>" alt="" class="bomb"> scary? <i class="fa fa-question-circle"></i> 
					<p class="more-hint">[Prep for The Journey]</p>
				</p>
				<div class="message-form froalize save-this color-blue" data-save-code="belts-for-bomb">
					<textarea>
						<%= @story.story_details["belts-for-bomb"].html_safe if @story.story_details.present? && @story.story_details["belts-for-bomb"].present? %>
					</textarea>
				</div>
				
				<!--  -->
				<hr>
				<div class="necessary-form">
					<ul class="pp-list n-list">
						
					</ul>
				</div>

				<i class="fa fa-plus btn btn-primary add-pp"></i>
			</div>

			<hr>
		</article>


		<%= render "stories/sections/spine" %>

		<article class="minimal" key="minimal">

			


			
			<div class="message">
				
			</div>

			<div class="message-because">
				<b><i>Because:</i></b>
				<div class="mebe"></div>
			</div>

			<article class="part" id="part-pre-4">
				<div class="row">
					<div class="col-lg-6 act-1-highlight">
						<h1>Intro:</h1>
						<% highlight = @story.story_details["act-1-highlight"] if @story.story_details.present? && @story.story_details["act-1-highlight"].present? %>						
						<div class="btn btn-info btn-block play-time"><i class="fa fa-play"></i></div>
						<input type="text" class="form-control timestamp" placeholder="Timestamp..." value="<%= highlight["timestamp"] if highlight.present?  %>">
						<textarea type="text" class="form-control description act-description" placeholder="Description..."><%=  highlight["description"] if highlight.present?  %></textarea>

						<p class="me-intro melo"></p>

					</div>
					<div class="col-lg-6 act-3-highlight">
						<h1>Climax:</h1>
						<% highlight = @story.story_details["act-3-highlight"] if @story.story_details.present? && @story.story_details["act-1-highlight"].present? %>
						<div class="btn btn-info btn-block play-time"><i class="fa fa-play"></i></div>
						<input type="text" class="form-control timestamp" placeholder="Timestamp..." value="<%= highlight["timestamp"] if highlight.present?  %>">
						<textarea type="text" class="form-control description act-description" placeholder="Description..."><%=  highlight["description"] if highlight.present?  %></textarea>

						<div class="me-climax">
							<p class="me-climax-1 melo"></p>
						</div>

					</div>

					<%= render "stories/climax_pieces"%>

					<div class="col-lg-12 catalyst">
						<h1>Main Tension:</h1>
						<small>Personal Hell and/or Paradise to help feelings prepare for climax.</small>
						<div class="message-form froalize save-this color-blue" data-save-code="catalyst">
							<textarea>
								<%= @story.story_details["catalyst"].html_safe if @story.story_details.present?  && @story.story_details["catalyst"].present?   %>
							</textarea>
						</div>

						<div class='II-because'>
							<h3>And we care <i>Because:</i></h3>
							<% highlight = @story.story_details["act-1-highlight"] if @story.story_details.present? && @story.story_details["act-1-highlight"].present? %>
							<p>
								<%=  highlight["description"] if highlight.present?  %>
							</p>
						</div>

						<div class="II-works">
							<h4>And this Tension works <i>Because:</i></h4>
							<% highlight = @story.story_details["act-II-works"] if @story.story_details.present? && @story.story_details["act-II-works"].present? %>
							<div class="message-form froalize save-this color-blue" data-save-code="act-II-works">
								<textarea>
									<%= @story.story_details["act-II-works"].html_safe if @story.story_details.present?  && @story.story_details["act-II-works"].present?   %>
								</textarea>
							</div>
						</div>



						<%= render "stories/mini_tension" %>
						
					</div>
				</div>
			</article>

		</article>

		<%= render "stories/scenes/scenes" %>	

	</section>

</div>



<!-- Notes Opener -->
<div id="notes-opener" class="notes-opener">
</div>
<div id="notes">
	<div id="notes-opener" class="notes-opener">
	
	</div>
	
	<h1>Notes:</h1>
	<hr>
	<section id="notepad">
		<%= @story.story_details["notes"].html_safe if @story.story_details.present? && @story.story_details["notes"].present? %>
	</section>
	<hr>
</div>



<%= render "negative_traits/modal" %>
<%= render "positive_traits/modal" %>

<%= render "stories/watch" %>


<script>

$(".acts i").on("click", function(){
	$(this).parent().toggleClass("fleshed-out-act")
	displayAct($(this).parent())
})

function displayAct(act){
	if (act.hasClass("fleshed-out-act")){
		act.closest(".act").find(".bare-bones").slideUp()
		act.closest(".act").find(".fleshed-out").slideDown()
	} else {
		act.closest(".act").find(".bare-bones").slideDown()
		act.closest(".act").find(".fleshed-out").slideUp()
	}
}

$('.collapse-clicker').click( function(e) {
    $('.collapse').collapse('hide');
});



function makeFroala(){

		// $(".froalize textarea, textarea.froalize").froalaEditor("edit.off");

		$(".froalize textarea, textarea.froalize").froalaEditor({
			key: froalaKey,
			toolbarInline: true,
			charCounterCount: false,
			toolbarButtons: ['bold', 'italic', 'underline', 'strikeThrough', 'color', 'emoticons', '-', 'paragraphFormat', 'align', 'formatOL', 'formatUL', 'indent', 'outdent', '-', 'insertImage', 'insertLink', 'insertFile', 'insertVideo', 'undo', 'redo', 'inlineClass'],
			saveInterval: 500,
			inlineClasses: {
				'pp-changer': 'Changer',
				'pp-villian': 'Villian',
				'pp-character': 'Character',
				'pp-object': 'Object',
				'pp-location': 'Location'
			}
		})
		.on('froalaEditor.save.before', function (e, editor) {
			// Before save request is made.
			saveStory()
			save()
		})
			.on('froalaEditor.save.after', function (e, editor, response) {
			// After successfully save request.
		})
			.on('froalaEditor.save.error', function (e, editor, error) {
			// Do something here.
		});
	


}




function details(){
	
	list = {}

	$(".save-this").each(function(){
		code = $(this).attr("data-save-code")
		list[code] = $(this).find(".fr-view").html()
	})

	list["necessary-list"] = saveNList()

	list["negative_traits"] = []
	$(".nt-list").find("li").each(function(){
		list["negative_traits"].push($(this).attr("data-id"))
	})

	list["positive_traits"] = []
	$(".pt-list").find("li").each(function(){
		list["positive_traits"].push($(this).attr("data-id"))
	})
	
	// Skeleton
	list["act-1-skeleton"] = []
	$(".act-1.skeleton-list").find("li").each(function(){
		list["act-1-skeleton"].push($(this).find(".fr-view").html())
	})

	list["act-2-skeleton"] = []
	$(".act-2.skeleton-list").find("li").each(function(){
		list["act-2-skeleton"].push($(this).find(".fr-view").html())
	})

	list["act-3-skeleton"] = []
	$(".act-3.skeleton-list").find("li").each(function(){
		list["act-3-skeleton"].push($(this).find(".fr-view").html())
	})

	// Scenes
	list["act-1-scenes"] = []
	$(".act-1.scenes-list").find("li").each(function(){
		list["act-1-scenes"].push({
			timestamp: $(this).find(".timestamp").val(),
			body: ($(this).find(".fr-view").html() || ""),
			script: $(this).attr("data-script"),
			emotion: $(this).attr("emotion")
		})
	})

	list["act-2-scenes"] = []
	$(".act-2.scenes-list").find("li").each(function(){
		list["act-2-scenes"].push({
			timestamp: $(this).find(".timestamp").val(),
			body: ($(this).find(".fr-view").html() || ""),
			script: $(this).attr("data-script"),
			emotion: $(this).attr("emotion")
		})
	})

	list["act-3-scenes"] = []
	$(".act-3.scenes-list").find("li").each(function(){
		list["act-3-scenes"].push({
			timestamp: $(this).find(".timestamp").val(),
			body: ($(this).find(".fr-view").html() || ""),
			script: $(this).attr("data-script"),
			emotion: $(this).attr("emotion")
		})
	})

	list["notes"] = $("#notes").find(".fr-view").html()

	list["transition"] = $(".transition").val()
	

	list["act-1-highlight"] = {
		description: $(".act-1-highlight").find(".description").val(),
		timestamp: $(".act-1-highlight").find(".timestamp").val()
	}

	list["act-3-highlight"] = {
		description: $(".act-3-highlight").find(".description").val(),
		timestamp: $(".act-3-highlight").find(".timestamp").val()
	}
	
	refreshFull()

	list["places"] = getPlaces()
	list["mini-tensions"] = saveMiniTensions()
	list["cp"] = saveCP()

	list["hell_build"] = saveHellBuild()
	list["climax_build"] = saveClimaxBuild()

	list["proofs"] = saveProofs()

	console.log(list)



	return list
}

$(".transition").on("change", function(){
	saveStory()
    save()
})


$(".year-input").typeWatch( options );
$(".tags-input").typeWatch( options );
$(".writer-input").typeWatch( options );
$(".link-input").typeWatch( options );
$(".series-input").typeWatch( options );

$(".cover-input").typeWatch( options );

$(".timestamp").typeWatch( options );
$("#part-pre-4 input").typeWatch( options );

$(".act-description").typeWatch( options );



function saveStory(){
	// alert("hi")
   original = $(".boolean-toggle .active").attr("title")
   if (original == "Ready") {
   	original = true
   } else {
   	original = false
   }
   // console.log(original)
   
   makeMagic()

   pitch = $(".pitch .fr-view").html()
   if (pitch == "<p><br></p>"){
	pitch = null
   }
   console.log("pitch", pitch)

   $.ajax({
       type: "PUT",
       dataType: "json",
       url: '/stories/<%= @story.id %>',
       contentType: 'application/json',
       data: JSON.stringify({ 
       	title: $(".title-form").find(".fr-view").text(),
       	story_details: details(),
       	original: original,
       	year: $(".year-input").val(),
       	tags: $(".tags-input").val(),
       	writer: $(".writer-input").val(),
       	link: $(".link-input").val(),
       	series: $(".series-input").val(),
       	cover: $(".cover-input").val(),
       	pitch: pitch,
        _method:'post' 
       }),
       success: function(res){
         console.log(res)
         console.log("Saved!")
       }
   })

   // alertify.success('Saved!');
}

function save(){

}

$(".delete-draft").on("click", function(){
	id = $(this).attr("data-id")
   $.ajax({
       type: "DELETE",
       dataType: "json",
       url: '/story_recipes/' + id,
       contentType: 'application/json',
       data: JSON.stringify({ 
          _method:'post' 
       }),
       success: function(res){
         console.log(res)
       }
   })
   $(this).closest(".list-group-item").remove()
})

$("body").on("click", ".remove-item", function(){
	$(this).closest("li").remove()
	countCharacters()
	makeCharacters()
	saveStory()
})

$(".add-n-item").on("click", function(){
	$(".necessary-form>ul").append(`<li>
				<div class="row">
					<div class="col-lg-10 element">
						<textarea class="froalize">
						</textarea>
					</div>
					<div class="col-lg-2 spans-nav">
						<span class="remove-item">
							<i class="fa fa-times"></i>
						</span>
						<span class="handle">
							<i class="fa fa-bars"></i>
						</span>
						<span>
							<i class="fa fa-users" aria-hidden="true"></i>
						</span>
						<span class="toggle-characters btn">
							0
						</span>
					</div>
				</div>
				<ul class="characters" id="`+$(".n-list>li").length+`-ch-list">
					<hr>
					<span class="btn btn-primary add-character">
						Add Character
					</span>
				</ul>
			</li>`)
	makeFroala()
	makeSorted("n-list")
	countCharacters()
})

function makeSorted(id){
	var el = document.getElementById(id);
	// var sortable = Sortable.create(list);
	var sortable = Sortable.create(el, {
		handle: ".handle",
		onUpdate: function(/**Event*/evt) {
			evt.newIndex // most likely why this event is used is to get the dragging element's current index
			// same properties as onEnd
			saveStory()
		}
	});
	makeCharacters()

}



	$("body").on("click", ".add-character", function(){
		ul = $(this).closest("li").find(".characters")
		ul.append(`<li>
			<div class="row">
				<div class="col-lg-11">
					<div class="color-nav">
						<span class="color-select villian" data-color="villian"></span>
						<span class="color-select alternative" data-color="alternative"></span>
					</div>
					<div class="name character-name">
						<input class="form-control" type='text' placeholder="Enter Character Name...">
					</div>
					<div class="connection">
						<textarea class="froalize"></textarea>
					</div>
				</div>
				<div class="col-lg-1 spans-nav">
					<span class="remove-item">
						<i class="fa fa-times"></i>
					</span>
					<span>
						<i class="fa fa-bars handle"></i>
					</span>
				</div>
			</div>
		</li>`)
		makeFroala()
		makeSorted($(this).closest(".characters").attr("id"))
		$(".pp-list input").typeWatch( pp_input );
		countCharacters()
	})

	$("body").on("click", ".fa-users", function(){
		$(this).closest("li").find(".characters").toggle()
	})

	$("body").on("click", ".toggle-characters", function(){
		$(this).closest("li").find(".characters").toggle()
	})

	function countCharacters(){
		$(".n-list > li").each(function(){
			count = $(this).find(".toggle-characters")
			count.html($(this).find(".characters > li").length)
		})
	}

	countCharacters()

	// makeSorted("n-list")
	$(".characters").each(function(){
		console.log($(this).attr("id"))
		// makeSorted($(this).attr("id"))
	})

	function makeCharacters(){
	}

	




	$(".notes-opener").on("click", function(){
		$("#notes").toggle("slide");
	})


	$(':checkbox').checkboxpicker({
	  offLabel: 'Study',
	  onLabel: 'Original'
	}
	).on('change', function(el) {
		console.log($(this).attr('checked'))
	});

	<% if @story.original == true %>
		$('#status').prop('checked', true);
	<% end %>

	$("body").on('click', ".boolean-toggle .btn-group .btn", function(){
		saveStory()
	})

	$("body").on("click", ".color-select", function(){
		$(this).toggleClass("active")
		saveStory()
		makeCharacters()
	})

	$(".toggle-extra").on('click', function(){
		$(".extra-details").toggle()
	})


	$(".add-t").on("click", function(){
		val = $(this).closest("div").find("select").val()
		ul = $(this).closest("div").find(".selected")
		name = $(this).closest("div").find("select option:selected" ).html();
		ul.append("<li data-id='"+val+"'><i class='fa fa-times remove-item'></i>"+name+"</li>")
		saveStory()
	})

	$("body").on("click", ".selected li", function(){
		
		modal = $("#" + $(this).closest("ul").attr('data-trigger'))
		link = $(this).closest("ul").attr('data-link')

		$.getJSON( "/"+link+"/" + $(this).attr("data-id"), function( data ) {
		  console.log(data)
		  $.each(data["details"], function(index, item){
			console.log(index)
			modal.find(".modal-title").html(data["title"])
			modal.find(".deet[data-title='"+index+"']").find("p").html(item)
		  })

		  modal.show()
		  modal.modal("show")
		});
	})

	function makeGlobalFroala(){

		$(".scenes-list .body, .skeleton-list .body, #notepad, .catalyst textarea").froalaEditor({
			key: froalaKey,
			toolbarInline: true,
			charCounterCount: false,
			toolbarButtons: ['bold', 'italic', 'underline', 'strikeThrough', 'color', 'emoticons', '-', 'paragraphFormat', 'align', 'formatOL', 'formatUL', '-', 'undo', 'redo', 'inlineClass'],
			inlineClasses: {
				'pp-changer': 'Changer',
				'pp-villian': 'Villian',
				'pp-character': 'Character',
				'pp-object': 'Object',
				'pp-location': 'Location'
			},
			saveInterval: 500,
		})
		.on('froalaEditor.save.before', function (e, editor) {
			// Before save request is made.
			saveStory()
			save()
		})
		.on('froalaEditor.save.after', function (e, editor, response) {
			// After successfully save request.
		})
		.on('froalaEditor.save.error', function (e, editor, error) {
			// Do something here.
		});

		console.log("Dwlluiikond1D-13zg1bhfvxyeE2F-10vw==")
			


	}
	

	makeGlobalFroala()


</script>


<!--  -->

<script>
	$("body").on("click", ".deet li", function(){
		val = $(this).html()
		// console.log(val)

		// modal
		title = $(this).closest(".modal").find(".modal-title").html()
		
		tag = $(this).closest(".modal").attr("alias")
		
		scenes = $(".scenes")

		scenes.append(`<li>`+tag + ": " + title + " " + val+`</li>`)

		console.log(tag + ": " + title + " " + val)

	})

	$("body").on("click", ".toggle-video", function(){
		$("#film-watch").toggle()
	})

</script>


<!--  -->





<%= render "stories/screenwriter/modal" %>

<%= render "stories/puzzle" %>
<%= render "stories/places" %>


<%= render "stories/modals/hells" %>

<!--  -->
<!-- MOTIFS -->
<!-- END -->
<!--  -->


<% @inspirable_type = "Story" %>
<% @inspirable_id = @story.id %>
<% @inspirable = @story %>
<%= render "inspirations/modal" %>


<%= render "stories/pusher/pusher" %>